"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8592],{4560:(P,m,s)=>{s.r(m),s.d(m,{startFocusVisible:()=>e});const f="ion-focused",i=["Tab","ArrowDown","Space","Escape"," ","Shift","Enter","ArrowLeft","ArrowRight","ArrowUp","Home","End"],e=a=>{let t=[],o=!0;const n=a?a.shadowRoot:document,b=a||document.body,c=y=>{t.forEach(j=>j.classList.remove(f)),y.forEach(j=>j.classList.add(f)),t=y},u=()=>{o=!1,c([])},$=y=>{o=i.includes(y.key),o||c([])},S=y=>{if(o&&y.composedPath){const j=y.composedPath().filter(I=>!!I.classList&&I.classList.contains("ion-focusable"));c(j)}},M=()=>{n.activeElement===b&&c([])};return n.addEventListener("keydown",$),n.addEventListener("focusin",S),n.addEventListener("focusout",M),n.addEventListener("touchstart",u),n.addEventListener("mousedown",u),{destroy:()=>{n.removeEventListener("keydown",$),n.removeEventListener("focusin",S),n.removeEventListener("focusout",M),n.removeEventListener("touchstart",u),n.removeEventListener("mousedown",u)},setFocus:c}}},4474:(P,m,s)=>{s.d(m,{a:()=>i,b:()=>a,c:()=>t,d:()=>e,e:()=>o,f:()=>v,g:()=>f});const f="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><title>Caret Down</title><path d='M64 144l192 224 192-224H64z'/></svg>",v="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><title>Caret Up</title><path d='M448 368L256 144 64 368h384z'/></svg>",i="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><title>Chevron Back</title><path stroke-linecap='round' stroke-linejoin='round' stroke-width='48' d='M328 112L184 256l144 144' class='ionicon-fill-none'/></svg>",e="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><title>Chevron Down</title><path stroke-linecap='round' stroke-linejoin='round' stroke-width='48' d='M112 184l144 144 144-144' class='ionicon-fill-none'/></svg>",a="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><title>Chevron Forward</title><path stroke-linecap='round' stroke-linejoin='round' stroke-width='48' d='M184 112l144 144-144 144' class='ionicon-fill-none'/></svg>",t="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><title>Chevron Forward</title><path stroke-linecap='round' stroke-linejoin='round' stroke-width='48' d='M184 112l144 144-144 144' class='ionicon-fill-none'/></svg>",o="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><title>Ellipsis Horizontal</title><circle cx='256' cy='256' r='48'/><circle cx='416' cy='256' r='48'/><circle cx='96' cy='256' r='48'/></svg>"},9955:(P,m,s)=>{s.d(m,{S:()=>v});const v={bubbles:{dur:1e3,circles:9,fn:(i,e,a)=>{const t=i*e/a-i+"ms",o=2*Math.PI*e/a;return{r:5,style:{top:9*Math.sin(o)+"px",left:9*Math.cos(o)+"px","animation-delay":t}}}},circles:{dur:1e3,circles:8,fn:(i,e,a)=>{const t=e/a,o=i*t-i+"ms",n=2*Math.PI*t;return{r:5,style:{top:9*Math.sin(n)+"px",left:9*Math.cos(n)+"px","animation-delay":o}}}},circular:{dur:1400,elmDuration:!0,circles:1,fn:()=>({r:20,cx:48,cy:48,fill:"none",viewBox:"24 24 48 48",transform:"translate(0,0)",style:{}})},crescent:{dur:750,circles:1,fn:()=>({r:26,style:{}})},dots:{dur:750,circles:3,fn:(i,e)=>({r:6,style:{left:9-9*e+"px","animation-delay":-110*e+"ms"}})},lines:{dur:1e3,lines:8,fn:(i,e,a)=>({y1:14,y2:26,style:{transform:`rotate(${360/a*e+(e<a/2?180:-180)}deg)`,"animation-delay":i*e/a-i+"ms"}})},"lines-small":{dur:1e3,lines:8,fn:(i,e,a)=>({y1:12,y2:20,style:{transform:`rotate(${360/a*e+(e<a/2?180:-180)}deg)`,"animation-delay":i*e/a-i+"ms"}})},"lines-sharp":{dur:1e3,lines:12,fn:(i,e,a)=>({y1:17,y2:29,style:{transform:`rotate(${30*e+(e<6?180:-180)}deg)`,"animation-delay":i*e/a-i+"ms"}})},"lines-sharp-small":{dur:1e3,lines:12,fn:(i,e,a)=>({y1:12,y2:20,style:{transform:`rotate(${30*e+(e<6?180:-180)}deg)`,"animation-delay":i*e/a-i+"ms"}})}}},9385:(P,m,s)=>{s.d(m,{w:()=>o});var f=s(655),v=s(5254),i=s(1086),e=s(2994),a=s(5e3),t=s(3349);let o=(()=>{class n{constructor(c,u,$){this.loadingController=c,this.toastController=u,this.alertController=$}presentLoading(c){return(0,v.D)(this.loadingController.create({message:c})).pipe((0,e.b)(u=>{this.loader=u,u.present()}))}dismissLoading(){return this.loader?(0,v.D)(this.loader.dismiss()):(0,i.of)(null)}presentToast(c){return(0,f.mG)(this,void 0,void 0,function*(){const u=yield this.toastController.create(c);return yield u.present(),u})}}return n.\u0275fac=function(c){return new(c||n)(a.LFG(t.HT),a.LFG(t.yF),a.LFG(t.Br))},n.\u0275prov=a.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},8780:(P,m,s)=>{s.d(m,{c:()=>T});var f=s(591),v=s(1086),i=s(6053),e=s(839);var o=s(2994),n=s(7224),b=s(1406),c=s(7545),u=s(4850),$=s(7221),S=s(5e3),M=s(7914),D=s(8222),y=s(8273),j=s(6883),I=s(7042),C=s(8241);let T=(()=>{class h{constructor(d,g,l,p,r,w){this.supabase=d,this.mapService=g,this.mapStore=l,this.photoService=p,this.geolocationService=r,this.uiState=w,this._projects$=new f.X([]),this.projects$=this._projects$.asObservable(),this._currentProjectId$=new f.X(null),this.currentProjectId$=this._currentProjectId$.asObservable()}loadProjects(){return this.supabase.loadProjects().pipe(function(h,E,d){let g;return g=h&&"object"==typeof h?h:{bufferSize:h,windowTime:E,refCount:!1,scheduler:d},l=>l.lift(function({bufferSize:h=Number.POSITIVE_INFINITY,windowTime:E=Number.POSITIVE_INFINITY,refCount:d,scheduler:g}){let l,r,p=0,w=!1,O=!1;return function(F){let x;p++,!l||w?(w=!1,l=new e.t(h,E,g),x=l.subscribe(this),r=F.subscribe({next(L){l.next(L)},error(L){w=!0,l.error(L)},complete(){O=!0,r=void 0,l.complete()}}),O&&(r=void 0)):x=l.subscribe(this),this.add(()=>{p--,x.unsubscribe(),x=void 0,r&&!O&&d&&0===p&&(r.unsubscribe(),r=void 0,l=void 0)})}}(g))}(),(0,o.b)(d=>this._projects$.next(d)))}addProject(d,g="bounds"){let l;switch(g){case"jordstykke":l=this.mapStore.selectedFeatureAsWKT$;break;case"draw":l=this.mapStore.drawnGeometry$;break;case"bounds":const p=this.mapService.getViewExtent();l=(0,v.of)(this.mapService.featureAsWKT(p,"EPSG:4326","EPSG:25832"))}l.pipe((0,n.P)(),(0,b.b)(p=>this.supabase.addProject(Object.assign(Object.assign({},d),{geom:p}))),(0,b.b)(p=>this.supabase.addMapViewState(p[0].id,this.mapStore.viewState)),(0,c.w)(()=>this.loadProjects())).subscribe()}addPhoto(){const g=`${(new Date).getTime()}.png`;this.uiState.updateUiState("uploadingImage",!0);const l=this.photoService.takePhoto().pipe((0,c.w)(r=>this.photoService.photoToBlob(r)),(0,c.w)(r=>this.supabase.uploadImage(g,r)),(0,u.U)(r=>r.data.Key)),p=this.geolocationService.getPosition().pipe((0,u.U)(r=>{const w=this.mapService.transform([r.coords.longitude,r.coords.latitude]);return`POINT(${w[0]} ${w[1]})`}));return(0,i.aj)([l,p]).pipe((0,c.w)(([r,w])=>this.supabase.addImageInfo({file_name:r,description:null,geom:w,project_id:this._currentProjectId$.value})),(0,c.w)(()=>this.loadProjects()),(0,o.b)(()=>this.uiState.updateUiState("uploadingImage",!1)),(0,$.K)(r=>(this.uiState.updateUiState("uploadingImage",!1),(0,v.of)(null))))}clearProjectState(){this._projects$.next([]),this._currentProjectId$.next(null),this.mapService.removeProjectOverlays()}setCurrentProjectId(d){this._currentProjectId$.next(d)}clearCurrentProject(){this._currentProjectId$.next(null),this.mapService.removeProjectOverlays()}}return h.\u0275fac=function(d){return new(d||h)(S.LFG(M.T),S.LFG(D.S),S.LFG(y.C),S.LFG(j.T),S.LFG(I._),S.LFG(C.J))},h.\u0275prov=S.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},8241:(P,m,s)=>{s.d(m,{J:()=>i});var f=s(591),v=s(5e3);let i=(()=>{class e{constructor(){this.initialState={activatedMapTools:[],uploadingImage:!1,drawConfig:{inEditMode:!1,showBack:!0,showDelete:!0,showSave:!0,showUndo:!0}},this._uiState$=new f.X(this.initialState),this.uiState$=this._uiState$.asObservable()}updateUiState(t,o){const n=Object.assign(Object.assign({},this._uiState$.value),{[t]:o});this._uiState$.next(n)}toggleUiState(t){const o=Object.assign(Object.assign({},this._uiState$.value),{[t]:!this._uiState$.value[t]});this._uiState$.next(o)}shiftMapTool(t){const o=Object.assign(Object.assign({},this._uiState$.value),{activatedMapTools:[t]});this._uiState$.next(o)}addMapTool(t){const o=Object.assign(Object.assign({},this._uiState$.value),{activatedMapTools:[...this._uiState$.value.activatedMapTools,t]});this._uiState$.next(o)}removeMapTool(t){const o=Object.assign(Object.assign({},this._uiState$.value),{activatedMapTools:this._uiState$.value.activatedMapTools.filter(n=>n!==t)});this._uiState$.next(o)}removeAllMapTools(){const t=Object.assign(Object.assign({},this._uiState$.value),{activatedMapTools:[]});this._uiState$.next(t)}updateDrawUiState(t,o){const n=Object.assign(Object.assign({},this._uiState$.value),{drawConfig:Object.assign(Object.assign({},this._uiState$.value.drawConfig),{[t]:o})});this._uiState$.next(n)}resetDrawUiState(){Object.assign(Object.assign({},this._uiState$.value),{drawConfig:this.initialState.drawConfig})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=v.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);